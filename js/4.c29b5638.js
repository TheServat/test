(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"8b24":function(e,t,i){"use strict";i.r(t);var r=i("7a23");const s={class:"row q-gutter-md"},c={class:"text-h6"},n=Object(r["h"])("br",null,null,-1),a=Object(r["h"])("br",null,null,-1),o={class:"text-h6"},l=Object(r["h"])("br",null,null,-1),d=Object(r["h"])("br",null,null,-1),b={class:"text-subtitle2"},u=Object(r["h"])("br",null,null,-1),h=Object(r["h"])("br",null,null,-1),f={key:0},m=Object(r["h"])("br",null,null,-1),O=Object(r["h"])("br",null,null,-1),j={key:1},p=Object(r["h"])("br",null,null,-1),v=Object(r["h"])("br",null,null,-1);function g(e,t){const i=Object(r["z"])("q-btn"),g=Object(r["z"])("q-input"),y=Object(r["z"])("q-card-section"),k=Object(r["z"])("q-card"),w=Object(r["z"])("q-page");return Object(r["t"])(),Object(r["e"])(w,{class:""},{default:Object(r["E"])((()=>[Object(r["h"])("div",null,[Object(r["h"])(g,{modelValue:e.symbol,"onUpdate:modelValue":t[1]||(t[1]=t=>e.symbol=t),placeholder:"BTCIRT"},{append:Object(r["E"])((()=>[Object(r["h"])(i,{round:"",dense:"",flat:"",icon:"add",onClick:e.newBot},null,8,["onClick"])])),_:1},8,["modelValue"])]),Object(r["h"])("div",s,[(Object(r["t"])(!0),Object(r["e"])(r["a"],null,Object(r["y"])(e.bots,((e,t)=>(Object(r["t"])(),Object(r["e"])(k,{class:"my-card",key:t},{default:Object(r["E"])((()=>[Object(r["h"])(y,null,{default:Object(r["E"])((()=>[Object(r["h"])("div",c,[Object(r["g"])(Object(r["B"])(t)+" ",1),n,Object(r["g"])(" isActive: "+Object(r["B"])(e.detectorData.isActive?"yes":"no")+" ",1),a,Object(r["g"])(" diff: "+Object(r["B"])(e.detectorData.diff),1)])])),_:2},1024)])),_:2},1024)))),128))]),(Object(r["t"])(!0),Object(r["e"])(r["a"],null,Object(r["y"])(e.trades,((e,t)=>(Object(r["t"])(),Object(r["e"])("div",{class:"row q-gutter-md",key:t},[(Object(r["t"])(!0),Object(r["e"])(r["a"],null,Object(r["y"])(e,(e=>(Object(r["t"])(),Object(r["e"])(k,{class:"my-card",key:e},{default:Object(r["E"])((()=>[Object(r["h"])(y,null,{default:Object(r["E"])((()=>[Object(r["h"])("div",o,[Object(r["g"])(Object(r["B"])(t)+" ",1),l,Object(r["g"])(" ask: "+Object(r["B"])(e.trade.trade.current.ask)+" ",1),d,Object(r["g"])(" bid: "+Object(r["B"])(e.trade.trade.current.bid),1)]),Object(r["h"])("div",b,[Object(r["g"])(Object(r["B"])(e.startTime.toISO())+" ",1),u,Object(r["g"])(" runningTime: "+Object(r["B"])(e.startTime.toRelative()),1)])])),_:2},1024),Object(r["h"])(y,{class:"q-pt-none"},{default:Object(r["E"])((()=>{var t;return[Object(r["g"])(" status: "+Object(r["B"])(e.status)+" ",1),h,e.buyTime?(Object(r["t"])(),Object(r["e"])("span",f,[Object(r["g"])(" buyTime: "+Object(r["B"])(e.buyTime.toISO())+" ",1),m,Object(r["g"])(" buyRunning: "+Object(r["B"])(e.startTime.diff(e.buyTime).as("minutes"))+" minutes ",1),O])):Object(r["f"])("",!0),e.sellTime?(Object(r["t"])(),Object(r["e"])("span",j,[Object(r["g"])(" buyTime: "+Object(r["B"])(e.sellTime.toISO())+" ",1),p,Object(r["g"])(" buyRunning: "+Object(r["B"])(null===(t=e.buyTime)||void 0===t?void 0:t.diff(e.sellTime).as("minutes"))+" minutes ",1),v])):Object(r["f"])("",!0)]})),_:2},1024)])),_:2},1024)))),128))])))),128))])),_:1})}var y=i("ce1f"),k=function(e,t,i,r){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,c){function n(e){try{o(r.next(e))}catch(t){c(t)}}function a(e){try{o(r["throw"](e))}catch(t){c(t)}}function o(e){e.done?i(e.value):s(e.value).then(n,a)}o((r=r.apply(e,t||[])).next())}))};class w{sleep(e){return k(this,void 0,void 0,(function*(){return new Promise((t=>{setTimeout((()=>t()),e)}))}))}wathOrdetBook(e,t,i=500){this.orderbook(e).then((r=>k(this,void 0,void 0,(function*(){t(r),yield this.sleep(i),this.wathOrdetBook(e,t,i)})))).catch((r=>{console.error(r),this.wathOrdetBook(e,t,i)}))}post(e,t,i="cors"){return k(this,void 0,void 0,(function*(){const r=e,s=new Request(r,{method:"post",mode:i,cache:"no-cache",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(t)});try{const e=yield fetch(s);return yield e.json()}catch(c){return this.post(e,t,i)}}))}get(e,t,i="cors"){return k(this,void 0,void 0,(function*(){const r=new URL(e);if(t)for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const i=t[e];r.searchParams.set(e,i)}const s=new Request(r.toString(),{method:"get",mode:i,cache:"no-cache",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer"}),c=yield fetch(s);return yield c.json()}))}}class P{get bidsAvg(){const e=this.bids.map((e=>({price:e.price,count:e.count,sum:e.count*e.price}))),t=e.reduce(((e,t)=>e+t.count),0),i=e.reduce(((e,t)=>e+t.sum),0);return i/t}get asksAvg(){const e=this.asks.map((e=>({price:e.price,count:e.count,sum:e.count*e.price}))),t=e.reduce(((e,t)=>e+t.count),0),i=e.reduce(((e,t)=>e+t.sum),0);return i/t}get maxBidPrice(){return this.bids.reduce(((e,t)=>Math.max(e,t.price)),0)}get minBidPrice(){return this.bids.reduce(((e,t)=>Math.min(e,t.price)),Number.MAX_VALUE)}get maxAskPrice(){return this.asks.reduce(((e,t)=>Math.max(e,t.price)),0)}get minAskPrice(){return this.asks.reduce(((e,t)=>Math.min(e,t.price)),Number.MAX_VALUE)}toJson(){return{bids:this.bids,asks:this.asks,asksAvg:this.asksAvg,bidsAvg:this.bidsAvg,maxBidPrice:this.maxBidPrice,minBidPrice:this.minBidPrice,maxAskPrice:this.maxAskPrice,minAskPrice:this.minAskPrice}}}class T extends P{constructor(e){super(),Object.defineProperty(this,"_bids",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_asks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._bids=e.bids.map((e=>({price:parseFloat(e[0]),count:parseFloat(e[1])}))),this._asks=e.asks.map((e=>({price:parseFloat(e[0]),count:parseFloat(e[1])})))}get bids(){return this._bids}get asks(){return this._asks}}var A=function(e,t,i,r){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,c){function n(e){try{o(r.next(e))}catch(t){c(t)}}function a(e){try{o(r["throw"](e))}catch(t){c(t)}}function o(e){e.done?i(e.value):s(e.value).then(n,a)}o((r=r.apply(e,t||[])).next())}))};class _ extends w{orderbook(e){return A(this,void 0,void 0,(function*(){const t=yield this.post("https://api.nobitex.ir/v2/orderbook",{symbol:e});return new T(t)}))}}var B=i("64c5"),D=i("1315");class x extends B["EventEmitter"]{constructor(e){super(),Object.defineProperty(this,"bot",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastAsk",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_interval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isActive",{enumerable:!0,configurable:!0,writable:!0,value:{active:!1,time:D["DateTime"].local()}}),Object.defineProperty(this,"_detected",{enumerable:!0,configurable:!0,writable:!0,value:{current:{ask:0,bid:0,time:D["DateTime"].local()},history:[]}}),this.options=e.options.detector,this._interval=setInterval((()=>{this.isActive.time.diffNow().as("seconds")<-60&&(this.isActive.active=!1),this.isActive.active&&this._detected.current.ask>0&&this._detected.current.time.diffNow().as("second")<=-1*this.options.waitUntilFireSecond&&this.lastAsk!==this._detected.current.ask&&(this.fire("detect",{trade:this._detected}),this.lastAsk=this._detected.current.ask,this.reset())}),100)}set detected(e){const t={ask:e.ask,bid:e.bid,time:D["DateTime"].local()};if(t.ask===this._detected.current.ask)return void(this._detected.current.time=D["DateTime"].local());const i={current:t,history:[...this._detected.history.slice(-49)]};0!==this._detected.current.ask&&i.history.push(this._detected.current),this._detected=i}reset(){this._detected={current:{ask:0,bid:0,time:D["DateTime"].local()},history:[]}}set data(e){this.detect(e)}diffPercent(e,t){return(e-t)/Math.abs(e)*100}calcPercent(e,t){return e*t/100}detect(e){const t=this.diffPercent(e.bidsAvg,e.asksAvg);if(t>=this.options.activeAvgPercent&&(this.isActive.active=!0,this.isActive.time=D["DateTime"].local()),t<=this.options.avgPercent){const t=e.minAskPrice,i=t+this.calcPercent(t,this.options.tune);this.detected={ask:t,bid:i}}this.fire("data",{diff:t,isActive:this.isActive.active})}onDetect(e){this.on("detect",(t=>e(t.data)))}onData(e){this.on("data",(t=>e(t.data)))}destroy(){clearInterval(this._interval)}}class E extends B["EventEmitter"]{constructor(){super(...arguments),Object.defineProperty(this,"trades",{enumerable:!0,configurable:!0,writable:!0,value:[]})}set orderbook(e){let t=!1;this.trades.forEach((i=>{"buying"===i.status&&e.minBidPrice<=i.trade.trade.current.ask?(t=!0,i.status="selling",i.buyTime=D["DateTime"].local()):"selling"===i.status&&e.maxAskPrice>=i.trade.trade.current.bid&&(t=!0,i.status="completed",i.sellTime=D["DateTime"].local())})),t&&this.fire("change",this.trades)}newTrade(e){this.trades.push({status:"buying",trade:e,startTime:D["DateTime"].local()}),this.fire("change",this.trades)}onChange(e){this.on("change",(t=>e(t.data)))}}class C extends B["EventEmitter"]{constructor(e,t){super(),Object.defineProperty(this,"api",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"detector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.detector=new x(this),e.wathOrdetBook(t.symbol,(e=>{this.detector.data=e,this.fire("orderbook",e)})),this.detector.onDetect((e=>this.fire("trade",e)))}onTradeDetected(e){this.detector.onDetect(e)}onOrderbook(e){this.on("orderbook",(t=>e(t.data)))}onDetectorData(e){this.detector.onData(e)}onTestChanged(e){this.on("test-trade-changed",(t=>e(t.data)))}test(){const e=new E;this.onOrderbook((t=>e.orderbook=t)),this.onTradeDetected((t=>e.newTrade(t))),e.onChange((e=>this.fire("test-trade-changed",e)))}}const q={detector:{avgPercent:.5,lookBeforeTradeSecond:1,tune:2,waitUntilFireSecond:10,activeAvgPercent:.8},symbol:"XRPIRT"};class R extends y["a"]{constructor(){super(...arguments),Object.defineProperty(this,"api",{enumerable:!0,configurable:!0,writable:!0,value:new _}),Object.defineProperty(this,"bot",{enumerable:!0,configurable:!0,writable:!0,value:new C(this.api,q)}),Object.defineProperty(this,"bots",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"symbol",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"trades",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"detectorData",{enumerable:!0,configurable:!0,writable:!0,value:{isActive:!1,diff:0}})}get now(){return D["DateTime"].local()}newBot(){const e=this.symbol.toUpperCase();this.bots[e]||(this.bots[e]={bot:new C(this.api,Object.assign(Object.assign({},q),{symbol:e})),detectorData:{isActive:!1,diff:0}},this.bots[e].bot.onTestChanged((t=>this.trades[e]=t)),this.bots[e].bot.onDetectorData((t=>{this.bots[e].detectorData=t})),this.bots[e].bot.test()),this.symbol=""}}var S=i("9989"),I=i("27f9"),M=i("9c40"),U=i("f09f"),F=i("a370"),z=i("eebe"),N=i.n(z);R.render=g;t["default"]=R;N()(R,"components",{QPage:S["a"],QInput:I["a"],QBtn:M["a"],QCard:U["a"],QCardSection:F["a"]})}}]);